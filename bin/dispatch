# dispatch - part of Upshell
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

phase="$UPSHELL_PHASE"
config_file="$UPSHELL"/config

upshell_source() {
   echo "Sourcing $1"
   . "$1"
}

if [ -e "$config_file" ] ; then
   configs="$( cat "$config_file" )"
else
   configs="\$UPSHELL/modules/default"
fi
 
IFS='
'
for module in "$configs" ; do
   eval dir="$module"
   echo dir = "$dir"
   [ -d "$dir" ] || continue
   script="$dir"/"$phase"
   echo script = "$script"
   if [ -r "$script" ] ; then
      echo HIT
      echo "***"
      upshell_source "$script"
   fi
done

unset -v script dir config_file phase
